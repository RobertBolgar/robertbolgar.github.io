
            
          
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFT Minter & Affiliate Script Test</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.2/dist/ethers.umd.min.js"></script>
    <link rel="stylesheet" href="style.css"> <!-- Ensure you have this CSS file -->
</head>
<body>
<div class="container">
    <h1>NFT Minting & Affiliate Script Test</h1>
    <form id="mintForm">
    <label for="nftName">NFT Name:</label>
    <input type="text" id="nftName" name="nftName" placeholder="Enter NFT name" required>

    <label for="nftDescription">NFT Description:</label>
    <input type="text" id="nftDescription" name="nftDescription" placeholder="Enter NFT description" required>

    <label for="nftPrice">NFT Price (in BNB):</label>
    <input type="text" id="nftPrice" name="nftPrice" placeholder="Enter NFT price" required>

    <input type="submit" id="submit-button" value="Mint NFT"> <!-- Added ID here -->
    <div id="loading" style="display: none;">Loading...</div>
    <div id="message"></div>
</form>
</div>


<script type="text/javascript">
document.addEventListener('DOMContentLoaded', () => {
    const mintForm = document.getElementById('mintForm');
    const submitButton = document.getElementById('submit-button'); // Ensure this ID matches your submit button
    const loadingIndicator = document.getElementById('loading');
    const messageDiv = document.getElementById('message');

    // Define a function to check if the user is connected
    async function isConnected() {
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        const accounts = await provider.listAccounts();
        return accounts.length > 0;
    }

    mintForm.addEventListener('submit', async (e) => {
        e.preventDefault(); // Prevent the form from submitting traditionally
        submitButton.disabled = true; // Disable the submit button to prevent multiple submissions

        if (typeof window.ethereum === 'undefined') {
            console.log('Please install MetaMask!');
            messageDiv.innerText = 'Please install MetaMask!';
            messageDiv.style.color = 'red';
            submitButton.disabled = false; // Re-enable the submit button
            return;
        }

        try {
            loadingIndicator.style.display = 'block'; // Show loading indicator

            if (!(await isConnected())) {
                // Only call eth_requestAccounts if the user is not connected
                await window.ethereum.request({ method: "eth_requestAccounts" });
            }

            // Fetch values from form inputs
const nftName = document.getElementById('nftName').value;
const nftDescription = document.getElementById('nftDescription').value;
const nftPriceInput = document.getElementById('nftPrice').value; // Fetch the price input as a string


// Initialize ethers provider with MetaMask
const provider = new ethers.providers.Web3Provider(window.ethereum);
const signer = provider.getSigner();

// Get the user's Ethereum address from MetaMask
const addressToSendNFTTo = await signer.getAddress();

                    // Parse the URL to extract the affiliate address
function getAffiliateAddressFromURL() {
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    return urlParams.get('affiliate');
}

                 

// Get the affiliate address from the URL
const referringAffiliate = getAffiliateAddressFromURL();

               


            // Define the smart contract address and ABI (add your ABI array here)
            const nftMintContractAddress = "0xa3dd01A7cc14BF3112Cdb5835eFDcA732eccBf53";
            const nftMintABI = [
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "owner",
				"type": "address"
			}
		],
		"name": "OwnableInvalidOwner",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "account",
				"type": "address"
			}
		],
		"name": "OwnableUnauthorizedAccount",
		"type": "error"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "affiliate",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "commissionRate",
				"type": "uint256"
			}
		],
		"name": "AffiliateRegistered",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "affiliate",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "address",
				"name": "nft",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "CommissionPaid",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "affiliate",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "EarningsWithdrawn",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "previousOwner",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "OwnershipTransferred",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_affiliate",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_salePrice",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "_nft",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_tokenId",
				"type": "uint256"
			}
		],
		"name": "payCommission",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_affiliate",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_commissionRate",
				"type": "uint256"
			}
		],
		"name": "registerAffiliate",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "renounceOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "transferOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "withdrawEarnings",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"stateMutability": "payable",
		"type": "receive"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "affiliateEarnings",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "affiliates",
		"outputs": [
			{
				"internalType": "bool",
				"name": "isRegistered",
				"type": "bool"
			},
			{
				"internalType": "uint256",
				"name": "commissionRate",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_salePrice",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_rate",
				"type": "uint256"
			}
		],
		"name": "calculateCommission",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]
 


            // Create a contract instance
            const nftContract = new ethers.Contract(nftMintContractAddress, nftMintABI, signer);

            // Call the contract method to get the default affiliate address
            const defaultAffiliate = await nftContract.defaultAffiliate();

                    console.log('Default Affiliate:', defaultAffiliate);


            // Determine the affiliate address to use
            const affiliateToUse = referringAffiliate ? referringAffiliate : defaultAffiliate;

                    console.log('Referring Affiliate:', referringAffiliate);


            // Convert the price to Wei
            const nftPriceWei = ethers.utils.parseEther(nftPriceInput);

            // Prepare the URI for NFT metadata
            const uri = `data:application/json;base64,${btoa(JSON.stringify({ name: nftName, description: nftDescription }))}`;

            const overrides = {
    gasLimit: 900000 // Adjust the gas limit as needed
};

// Call the safeMint function with overrides
const transaction = await nftContract.safeMint(addressToSendNFTTo, nftPriceWei, uri, affiliateToUse, overrides);


            await transaction.wait(); // Wait for the transaction to be confirmed

            console.log('NFT Minted successfully!');
            messageDiv.innerText = 'NFT Minted successfully!';
            messageDiv.style.color = 'green';
        } catch (error) {
            console.error('Error:', error);
            messageDiv.innerText = 'Error: ' + error.message;
            messageDiv.style.color = 'red';
        } finally {
            loadingIndicator.style.display = 'none'; // Hide loading indicator
            submitButton.disabled = false; // Re-enable the submit button after the process
            mintForm.reset(); // Clear form fields after the process
        }
    });
});
</script>


</body>
</html>

           

            
            
            
