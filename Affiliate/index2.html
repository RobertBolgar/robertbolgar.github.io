<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFT Minter & Affiliate Script Test</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.2/dist/ethers.umd.min.js"></script>
    <link rel="stylesheet" href="style.css"> <!-- Ensure you have this CSS file -->
</head>
<body>
<div class="container">
    <h1>NFT Minting & Affiliate Script Test</h1>
    <form id="mintForm">
        <label for="nftName">NFT Name:</label>
        <input type="text" id="nftName" name="nftName" placeholder="Enter NFT name" required>

        <label for="nftDescription">NFT Description:</label>
        <input type="text" id="nftDescription" name="nftDescription" placeholder="Enter NFT description" required>

        <label for="nftPrice">NFT Price (in BNB):</label>
        <input type="text" id="nftPrice" name="nftPrice" placeholder="Enter NFT price" required>

        <input type="submit" value="Mint NFT">
        <div id="loading" style="display: none;">Loading...</div>
        <div id="message"></div>
    </form>
</div>


            

<script type="text/javascript">
document.addEventListener('DOMContentLoaded', () => {
    const mintForm = document.getElementById('mintForm');
    const loadingIndicator = document.getElementById('loading');
    const messageDiv = document.getElementById('message');

    mintForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        if (typeof window.ethereum === 'undefined') {
            console.log('Please install MetaMask!');
            return;
        }

        try {
            loadingIndicator.style.display = 'block'; // Show loading indicator

            const urlParams = new URLSearchParams(window.location.search);
            const nftName = urlParams.get('nftName');
            const nftDescription = urlParams.get('nftDescription');
            const nftPrice = urlParams.get('nftPrice');
            console.log('Price from URL:', nftPrice);
            const parsedPrice = parseFloat(nftPrice);
            console.log('Parsed Price:', parsedPrice);

            if (isNaN(parsedPrice) || parsedPrice <= 0) {
                throw new Error('Invalid price format');
            }

            // Assuming the price is provided in BNB, you might want to multiply it by a factor
            // to convert it to a suitable representation (e.g., Wei or Ether) for interacting with the Ethereum blockchain.
            // For example, if 1 BNB = 10^18 Wei, you would multiply the parsedPrice by 10^18.
            // Modify this conversion factor based on the actual conversion rate.
            const BNB_to_Wei_Factor = 10**18;
            const nftPriceEther = parsedPrice * BNB_to_Wei_Factor;

            const uri = `data:application/json;base64,${btoa(JSON.stringify({ name: nftName, description: nftDescription }))}`;

            const provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send("eth_requestAccounts", []);
            const signer = provider.getSigner();

            const affiliateCode = urlParams.get('affiliate'); // Extract affiliate code from URL query parameter

            const nftMintContractAddress = "0xbeB397c1a482D6739b71c357aB5D1cf4654342e1";
            
            const nftMintABI = [
    {
        "inputs": [
            {
                "internalType": "address",
                "name": "to",
                "type": "address"
            },
            {
                "internalType": "uint256",
                "name": "tokenId",
                "type": "uint256"
            }
        ],
        "name": "approve",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "inputs": [
            {
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            }
        ],
        "name": "getApproved",
        "outputs": [
            {
                "internalType": "address",
                "name": "",
                "type": "address"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [],
        "name": "isApprovedForAll",
        "outputs": [
            {
                "internalType": "bool",
                "name": "",
                "type": "bool"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": "tokenId",
                "type": "uint256"
            }
        ],
        "name": "ownerOf",
        "outputs": [
            {
                "internalType": "address",
                "name": "",
                "type": "address"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "bytes4",
                "name": "interfaceId",
                "type": "bytes4"
            }
        ],
        "name": "supportsInterface",
        "outputs": [
            {
                "internalType": "bool",
                "name": "",
                "type": "bool"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [],
        "name": "symbol",
        "outputs": [
            {
                "internalType": "string",
                "name": "",
                "type": "string"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "name": "tokenPrices",
        "outputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }
        ],
        "name": "tokenSellers",
        "outputs": [
            {
                "internalType": "address",
                "name": "",
                "type": "address"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "inputs": [
            {
                "internalType": "uint256",
                "name": "tokenId",
                "type": "uint256"
            }
        ],
        "name": "tokenURI",
        "outputs": [
            {
                "internalType": "string",
                "name": "",
                "type": "string"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    }
];

            const nftContract = new ethers.Contract(nftMintContractAddress, nftMintABI, signer);
            
            // Pass the affiliate code along with minting transaction
            const transaction = await nftContract.safeMint(signer.getAddress(), nftPriceEther, uri, affiliateCode || ethers.constants.AddressZero); // Use a default affiliate code if none is provided
            await transaction.wait(); // Wait for the transaction to be confirmed

            console.log('NFT Minted successfully!');
            messageDiv.innerText = 'NFT Minted successfully!';
            messageDiv.style.color = 'green';
            mintForm.reset(); // Clear form fields
        } catch (error) {
            console.error('Error:', error);
            if (error.code === -32603) {
                console.error('Internal JSON-RPC error. Please check your MetaMask connection and try again.');
            }
            messageDiv.innerText = 'Error: ' + error.message;
            messageDiv.style.color = 'red';
        } finally {
            loadingIndicator.style.display = 'none'; // Hide loading indicator
        }
    });
});
</script>


</body>
</html>

           

            
            
            
