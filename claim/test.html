<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLRT Vesting</title>
</head>
<body>
    <h1>PLRT Vesting</h1>
    <div id="walletInfo"></div>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.2/dist/web3.min.js"></script>
    <script>
        let web3;

        // Initialize Web3
        async function initWeb3() {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                } catch (error) {
                    console.error("User denied account access");
                    document.getElementById('walletInfo').innerHTML = '<p>Please connect your Ethereum wallet to access vesting details.</p>';
                    return;
                }
            } else if (window.web3) {
                web3 = new Web3(window.web3.currentProvider);
            } else {
                console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');
                document.getElementById('walletInfo').innerHTML = '<p>Please install MetaMask or a compatible Ethereum wallet to access vesting details.</p>';
                return;
            }
        }

        // Contract address and ABI
        const contractAddress = '0xB4308847b8060CB63463aa96bBbbbB23e958aeFa'; // Replace with your contract address
         

        async function main() {
            await initWeb3();

	fetch('abi.json')
    .then(response => response.json())
    .then(async abi => { // Marking this function as async
        const contract = new web3.eth.Contract(abi, contractAddress);

        // Now it's safe to use `await` since we are inside an async function
        const accounts = await web3.eth.getAccounts();
        const userAddress = accounts[0];

        // Continue with other async operations
        // Remember to handle errors appropriately
    })
    .catch(error => {
        console.error('Error loading ABI:', error);
        document.getElementById('walletInfo').innerHTML = '<p>Error loading contract ABI.</p>';
    });

            // Get user's wallet address
            const accounts = await web3.eth.getAccounts();
            const userAddress = accounts[0];

            // Get treasury wallet address
            const treasuryWallet = await contract.methods.treasuryWallet().call();

            // Get team member vesting details
            const teamMemberDetails = await contract.methods.getTeamMemberVestingDetails(userAddress).call();
            // Get private sale NFT vesting details
            const privateSaleNFTDetails = await contract.methods.getPrivateSaleNFTVestingDetails(userAddress).call();
            // Get treasury vesting details
            const treasuryDetails = await contract.methods.getTreasuryVestingDetails().call();

            let vestingDetailsHTML = `<h2>Wallet Address: ${userAddress}</h2>`;

            // Display team member vesting data
            if (teamMemberDetails[0] > 0) {
                vestingDetailsHTML += `
                    <div>
                        <h3>Team Member Vesting Details:</h3>
                        <p>Total Allocation: ${teamMemberDetails[0]}</p>
                        <p>Claimed Amount: ${teamMemberDetails[1]}</p>
                        <p>Remaining Claimable Amount: ${teamMemberDetails[2]}</p>
                    </div>
                `;
            }

            // Display private sale NFT vesting data
            if (privateSaleNFTDetails[0] > 0) {
                vestingDetailsHTML += `
                    <div>
                        <h3>Private Sale NFT Vesting Details:</h3>
                        <p>Total Allocation: ${privateSaleNFTDetails[0]}</p>
                        <p>Claimed Amount: ${privateSaleNFTDetails[1]}</p>
                        <p>Remaining Claimable Amount: ${privateSaleNFTDetails[2]}</p>
                    </div>
                `;
            }

            // Display treasury vesting data only if the connected wallet is the treasury wallet
            if (userAddress.toLowerCase() === treasuryWallet.toLowerCase()) {
                if (treasuryDetails[0] > 0) {
                    vestingDetailsHTML += `
                        <div>
                            <h3>Treasury Vesting Details:</h3>
                            <p>Total Allocation: ${treasuryDetails[0]}</p>
                            <p>Claimed Amount: ${treasuryDetails[1]}</p>
                            <p>Remaining Claimable Amount: ${treasuryDetails[2]}</p>
                        </div>
                    `;
                }
            }

            // If none of the vesting details have a non-zero allocation, display a message
            if (teamMemberDetails[0] === 0 && privateSaleNFTDetails[0] === 0 && (treasuryDetails[0] === 0 || userAddress.toLowerCase() !== treasuryWallet.toLowerCase())) {
                vestingDetailsHTML = '<p>The connected wallet does not have any vesting details.</p>';
            }

            document.getElementById('walletInfo').innerHTML = vestingDetailsHTML;

	.catch(error => {
                    console.error('Error loading ABI:', error);
                    document.getElementById('walletInfo').innerHTML = '<p>Error loading contract ABI.</p>';
                });
        }

        main().catch(console.error);
    </script>
</body>
</html>
