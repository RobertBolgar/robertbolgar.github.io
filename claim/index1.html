<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLRT Vesting</title>
</head>
<body>
    <h1>PLRT Vesting</h1>
    <div id="walletInfo"></div>

    <!-- Update the Web3.js CDN link to a more recent version -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.6.1/dist/web3.min.js"></script>
    <script>
        // Initialize Web3
        if (window.ethereum) {
            window.web3 = new Web3(window.ethereum);
            // Use the new method for requesting account access
            window.ethereum.request({ method: 'eth_requestAccounts' })
                .then(accounts => {
                    if (accounts.length > 0) {
                        console.log('Account:', accounts[0]);
                        // Proceed with initializing the application
                        initializeApp();
                    }
                })
                .catch((err) => {
                    console.error('User denied account access', err);
                });
        } else if (window.web3) {
            window.web3 = new Web3(window.web3.currentProvider);
            initializeApp();
        } else {
            console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');
        }

        function initializeApp() {
            // Fetch ABI from external JSON file
            fetch('abi.json')
                .then(response => response.json())
                .then(abi => {
                    // Contract address
                    const contractAddress = '0xB4308847b8060CB63463aa96bBbbbB23e958aeFa'; // Replace with your contract address

                    // Instantiate contract
                    const contract = new web3.eth.Contract(abi, contractAddress);

                    // Get user's wallet address
                    web3.eth.getAccounts().then(async function(accounts) {
                        const userAddress = accounts[0];

                        // Get vesting details for the user
                        const teamMemberDetails = await contract.methods.getTeamMemberVestingDetails(userAddress).call();
                        const privateSaleNFTDetails = await contract.methods.getPrivateSaleNFTVestingDetails(userAddress).call();
                        const treasuryDetails = await contract.methods.getTreasuryVestingDetails().call();

                        // Display vesting data
                        document.getElementById('walletInfo').innerHTML = `
                            <h2>Wallet Address: ${userAddress}</h2>

                            <div>
                                <h3>Team Member Vesting Details:</h3>
                                <p>Total Allocation: ${teamMemberDetails[0]}</p>
                                <p>Claimed Amount: ${teamMemberDetails[1]}</p>
                                <p>Remaining Claimable Amount: ${teamMemberDetails[2]}</p>
                            </div>

                            <div>
                                <h3>Private Sale NFT Vesting Details:</h3>
                                <p>Total Allocation: ${privateSaleNFTDetails[0]}</p>
                                <p>Claimed Amount: ${privateSaleNFTDetails[1]}</p>
                                <p>Remaining Claimable Amount: ${privateSaleNFTDetails[2]}</p>
                            </div>

                            <div>
                                <h3>Treasury Vesting Details:</h3>
                                <p>Total Allocation: ${treasuryDetails[0]}</p>
                                <p>Claimed Amount: ${treasuryDetails[1]}</p>
                                <p>Remaining Claimable Amount: ${treasuryDetails[2]}</p>
                            </div>
                        `;
                    });
                })
                .catch(error => console.error('Error fetching ABI:', error));
        }
    </script>
</body>
</html>
